<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Surron Configurator</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
/* layout */
html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
canvas{display:block}
/* modern left panel */
#menu{
position: absolute;
top: 20px;
left: 20px;
width: 260px;
background: linear-gradient(180deg, rgba(14,14,14,0.96), rgba(20,20,20,0.95));
color: #eee;
padding: 14px;
border-radius: 12px;
box-shadow: 0 12px 30px rgba(0,0,0,0.5);
z-index: 10;
}
#menu h1{margin:0 0 8px 0;font-size:16px}
.section{margin:10px 0;padding-bottom:6px;border-bottom:1px solid rgba(255,255,255,0.04)}
.label{font-size:13px;color:#bfc7d6;margin-bottom:6px}
.swatches{display:flex;flex-wrap:wrap;gap:8px}
.swatch{width:34px;height:34px;border-radius:50%;cursor:pointer;border:2px solid rgba(255,255,255,0.06);box-shadow:0 4px 10px rgba(0,0,0,0.45);transition:transform .12s, box-shadow .12s}
.swatch:hover{transform:scale(1.12);box-shadow:0 8px 18px rgba(0,0,0,0.6)}
.row{display:flex;gap:8px;align-items:center;margin-top:8px}
button.primary{background:#0ea5a4;border:none;color:#fff;padding:8px 10px;border-radius:8px;cursor:pointer}
.small{font-size:13px;padding:6px 8px;border-radius:8px;background:#222;color:#ddd;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
#bottomRow{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
/* small debug link */
.muted{font-size:12px;color:#9aa4b2;margin-top:8px}
</style>
</head>
<body>
<div id="menu" aria-label="Bike configurator">
<h1>Bike Configurator</h1>

<div class="section">
<div class="label">Frame</div>
<div class="swatches" id="frameSwatches"></div>
</div>

<div class="section">
<div class="label">Rims</div>
<div class="swatches" id="rimSwatches"></div>
</div>

<div class="section">
<div class="label">Seat</div>
<div style="display:flex;gap:8px;align-items:center">
<div id="seatSwatches" class="swatches"></div>
<button class="small" id="toggleSeatBtn">Toggle Seat</button>
</div>
</div>

<div class="section">
<div class="label">Presets</div>
<div class="row" id="presetRow">
<button class="small" onclick="applyPreset('stealth')">Stealth</button>
<button class="small" onclick="applyPreset('gold')">Gold Edition</button>
<button class="small" onclick="applyPreset('factory')">Factory Black</button>
</div>
</div>

<div id="bottomRow">
<button class="primary" onclick="downloadScreenshot()">Download Image</button>
<button class="small" onclick="dumpMeshNames()">Debug Names</button>
</div>

<div class="muted">Tip: click a swatch to change that part. Use "Debug Names" if colors don't apply â€” it'll print the mesh names to the browser console.</div>
</div>

<canvas id="c"></canvas>

<!-- three.js and loaders -->
<script src="https://unpkg.com/three@0.154.0/build/three.min.js"></script>
<script src="https://unpkg.com/three@0.154.0/examples/js/controls/OrbitControls.js"></script>
<script src="https://unpkg.com/three@0.154.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
// --------- CONFIG: edit if your mesh names are different ----------
// For robust matching we keep a list of name substrings to look for inside mesh.name
const PART_NAME_MAP = {
frame: ['frame'],
rim_front: ['rim_front','front','front_rim','wheel_front','frontrim'],
rim_rear: ['rim_rear','rear','rear_rim','wheel_rear','rearrim'],
seat: ['seat']
};

// default colors (hex strings)
const DEFAULTS = {
frame: '#b80f0f',
rim_front: '#222222',
rim_rear: '#222222',
seat: '#101010'
};

// presets: map part -> color string
const PRESETS = {
stealth: { frame:'#0b0b0b', rim_front:'#111111', rim_rear:'#111111', seat:'#000000'},
gold: { frame:'#b07b17', rim_front:'#ffd700', rim_rear:'#ffd700', seat:'#0b0b0b'},
factory: { frame:'#111111', rim_front:'#7d7d7d', rim_rear:'#7d7d7d', seat:'#050505'}
};
// ---------- end config ----------------------------------------------

// helper to find meshes for a logical part key
function meshMatchesPart(meshName, partKey) {
if (!meshName) return false;
const lower = meshName.toLowerCase();
const keywords = PART_NAME_MAP[partKey] || [];
return keywords.some(k => lower.includes(k));
}

// Build UI swatches
const frameSwatchesData = ['#b80f0f','#1a1a1a','#2a9d8f','#264653','#f4a261'];
const rimSwatchesData = ['#111111','#ffffff','#999999','#ffd700','#8b0000'];
const seatSwatchesData = ['#000000','#4e342e','#cfcfcf'];

function makeSwatches(containerId, partKey, list) {
const container = document.getElementById(containerId);
list.forEach(col => {
const b = document.createElement('button');
b.className = 'swatch';
b.style.background = col;
b.title = col;
b.onclick = () => setPartColor(partKey, col);
container.appendChild(b);
});
}

makeSwatches('frameSwatches','frame',frameSwatchesData);
makeSwatches('rimSwatches','rim_front',rimSwatchesData); // we'll use rim_front and rim_rear individually when needed
makeSwatches('seatSwatches','seat',seatSwatchesData);

// Setup three.js scene
const canvas = document.getElementById('c');
const renderer = new THREE.WebGLRenderer({canvas, antialias:true, alpha:false});
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth, window.innerHeight);

const scene = new THREE.Scene();
scene.background = new THREE.Color(0xEDEDED);

const camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.05, 100);
camera.position.set(0,1.6,3.2);

const controls = new THREE.OrbitControls(camera, renderer.domElement);
controls.target.set(0, 0.9, 0);
controls.enableDamping = true;
controls.dampingFactor = 0.08;

// lights
const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 1.0);
hemi.position.set(0,2,0);
scene.add(hemi);

const dir = new THREE.DirectionalLight(0xffffff, 0.8);
dir.position.set(4,8,2);
scene.add(dir);

// ground (subtle)
const ground = new THREE.Mesh(new THREE.PlaneGeometry(200,200), new THREE.MeshStandardMaterial({color:0xdddddd,metalness:0,roughness:1}));
ground.rotation.x = -Math.PI/2; ground.position.y = -0.01; scene.add(ground);

let bike = null;
let seatVisible = true;

// load GLB - ensure this name matches the file in your repo
const loader = new THREE.GLTFLoader();
loader.load('surron.glb',
function(gltf) {
bike = gltf.scene;
// ensure each mesh has its own material instance (so recolor won't affect other meshes)
bike.traverse(node=>{
if (node.isMesh) {
node.material = node.material ? node.material.clone() : new THREE.MeshStandardMaterial({color:0x999999});
// set a sane default metalness/roughness if missing
if (node.material.metalness === undefined) node.material.metalness = 0.2;
if (node.material.roughness === undefined) node.material.roughness = 0.5;
}
});
// center/scale if needed
const box = new THREE.Box3().setFromObject(bike);
const size = box.getSize(new THREE.Vector3());
const center = box.getCenter(new THREE.Vector3());
bike.position.sub(center); // center the model
scene.add(bike);

// apply defaults
for (const [k,v] of Object.entries(DEFAULTS)) setPartColor(k, v);
},
undefined,
function(err) { console.error('GLTF load error', err); alert('Model failed to load: check console for details'); }
);

// change color on all meshes that match the part key
function setPartColor(partKey, color) {
if (!bike) {
console.warn('Model not loaded yet');
return;
}
bike.traverse(child=>{
if (child.isMesh && meshMatchesPart(child.name, partKey)) {
// clone material to avoid shared-material issues
child.material = child.material.clone();
try {
child.material.color = new THREE.Color(color);
} catch(e) {
// support number hex as fallback
child.material.color.setHex(Number(color));
}
// polish
child.material.metalness = (partKey === 'rim_front' || partKey === 'rim_rear') ? 0.9 : 0.15;
child.material.roughness = (partKey === 'frame') ? 0.35 : child.material.roughness;
child.material.needsUpdate = true;
}
});
}

// apply preset
function applyPreset(presetName) {
const preset = PRESETS[presetName];
if (!preset) return;
Object.keys(preset).forEach(partKey => setPartColor(partKey, preset[partKey]));
// rims preset uses rim_front and rim_rear both set
if (preset.rim) { setPartColor('rim_front', preset.rim); setPartColor('rim_rear', preset.rim); }
}

// hookup UI: rim swatches should change both front & rear
document.getElementById('rimSwatches').querySelectorAll('.swatch').forEach(btn=>{
btn.onclick = () => { setPartColor('rim_front', btn.style.background); setPartColor('rim_rear', btn.style.background); };
});

// toggle seat
document.getElementById('toggleSeatBtn').addEventListener('click', () => {
if (!bike) return;
seatVisible = !seatVisible;
bike.traverse(child => {
if (child.isMesh && meshMatchesPart(child.name, 'seat')) child.visible = seatVisible;
});
});

// debug helper - prints every mesh name to console
function dumpMeshNames(){
if(!bike){ console.warn('Model not loaded yet'); return; }
console.log('--- Mesh names ---');
bike.traverse(c => { if (c.isMesh) console.log(c.name); });
alert('Mesh names printed to console.');
}
window.dumpMeshNames = dumpMeshNames; // expose

// screenshot function
function downloadScreenshot() {
renderer.render(scene, camera);
const dataURL = renderer.domElement.toDataURL('image/png');
const a = document.createElement('a');
a.href = dataURL;
a.download = 'surron-config.png';
a.click();
}
window.downloadScreenshot = downloadScreenshot;

// expose small helpers for debugging in console
window.setPartColor = setPartColor;
window.applyPreset = applyPreset;

// animation loop
function animate(){
requestAnimationFrame(animate);
controls.update();
renderer.render(scene, camera);
}
animate();

// resize
window.addEventListener('resize', ()=> {
renderer.setSize(window.innerWidth, window.innerHeight);
camera.aspect = window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
});
</script>
</body>
</html>
